<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Character Wheel Game</title>
<style>
  /* ---------------- GENERAL STYLES ---------------- */
  body { font-family: Arial, sans-serif; background: #222; color: #eee; text-align:center; }
  button { padding:10px 20px; margin:10px; cursor:pointer; }

  /* ---------------- WHEEL SECTION ---------------- */
  .wheelContainer { margin:20px auto; width:300px; height:300px; position:relative; }
  .wheel { width:100%; height:100%; border-radius:50%; border:5px solid #555; position:relative; }
  .slice { position:absolute; width:50%; height:50%; top:0; left:50%; transform-origin:0% 100%; overflow:hidden; }
  
  /* ---------------- BATTLE SECTION ---------------- */
  #battleContainer{
    text-align:center;
    margin-top:20px;
    width:100%;
    height:400px;
    position:relative;
    background-size:cover;
    background-position:center;
    transition:background 1s ease-in-out;
  }
  .battleChar{
    display:inline-block;
    position:relative;
    width:200px; height:300px;
    margin:50px;
  }
  .attackEffect, .particleEffect{
    position:absolute; top:0; left:0;
    width:100%; height:100%;
    background-size:contain;
    background-repeat:no-repeat;
    pointer-events:none;
    animation:none;
  }
  .damageText{
    position:absolute; top:-30px; left:50%;
    transform:translateX(-50%);
    font-size:24px;
    font-weight:bold;
    color:red;
    opacity:0;
    transition: all 0.8s ease-out;
  }
  @keyframes swing{
    0%{transform:rotate(0deg);}
    50%{transform:rotate(20deg);}
    100%{transform:rotate(0deg);}
  }
  @keyframes floatUp{
    0%{transform:translateY(0px) scale(1); opacity:1;}
    50%{transform:translateY(-20px) scale(1.2);}
    100%{transform:translateY(-50px) scale(1); opacity:0;}
  }
</style>
</head>
<body>

<h1>Character Wheel Game</h1>

<!-- ---------------- CHARACTER WHEELS ---------------- -->
<div class="wheelContainer">
  <div class="wheel" id="raceWheel">Race Wheel</div>
  <div class="wheel" id="powerWheel">Power Wheel</div>
  <div class="wheel" id="strengthWheel">Strength Wheel</div>
  <div class="wheel" id="durabilityWheel">Durability Wheel</div>
  <div class="wheel" id="regenWheel">Regen Wheel</div>
</div>

<!-- ---------------- EVENT SPIN & BATTLE ---------------- -->
<button onclick="spinEventWheel()">Spin PvE Event</button>

<div id="battleContainer">
  <!-- Player -->
  <div id="playerBattle" class="battleChar">
    <img id="playerPortrait" src="">
    <div class="attackEffect" id="playerEffect"></div>
    <div class="particleEffect" id="playerParticle1"></div>
    <div class="particleEffect" id="playerParticle2"></div>
    <div class="particleEffect" id="playerParticle3"></div>
    <div class="damageText" id="playerDamage"></div>
  </div>

  <!-- Enemy -->
  <div id="enemyBattle" class="battleChar">
    <img id="enemyPortrait" src="images/base/enemy.png">
    <div class="attackEffect" id="enemyEffect"></div>
    <div class="particleEffect" id="enemyParticle1"></div>
    <div class="particleEffect" id="enemyParticle2"></div>
    <div class="particleEffect" id="enemyParticle3"></div>
    <div class="damageText" id="enemyDamage"></div>
  </div>
</div>

<div id="fightLog"></div>

<script>
/* ---------------- PLAYER CHARACTER DATA ---------------- */
let currentCharacter = {
  race: {name:"Vampire"},
  power: {name:"Blood Overlord"},
  wheels: {
    strength: 10,
    durability: 50,
    regen: 4
  }
};

/* ---------------- EVENT WHEEL DATA ---------------- */
const eventWheel = [
  { name: "Golem Ambush", enemyRace: "Golem", enemyStrength: 15, enemyDurability: 60, enemyRegen: 3, background: "cave.png" },
  { name: "Shadow Vampire Attack", enemyRace: "Vampire", enemyStrength: 12, enemyDurability: 30, enemyRegen: 5, background: "castle.png" },
  { name: "Forest Bandits", enemyRace: "Elf", enemyStrength: 10, enemyDurability: 20, enemyRegen: 2, background: "forest.png" },
  { name: "Uchiha Rival", enemyRace: "Uchiha", enemyStrength: 18, enemyDurability: 25, enemyRegen: 4, background: "uchiha.png" }
];

/* ---------------- PARTICLE EFFECTS ---------------- */
function showParticleEffect(effectImage, particleSlot){
  let slot = document.getElementById(particleSlot);
  slot.style.backgroundImage = `url(${effectImage})`;
  slot.style.animation = 'floatUp 0.8s forwards';
  setTimeout(()=>{slot.style.backgroundImage=''; slot.style.animation='';},800);
}
function getAttackEffect(power){
  switch(power){
    case "Fire": return 'images/effects/fireAura.png';
    case "Ice": return 'images/effects/iceAura.png';
    case "Shadow Cloak": return 'images/effects/shadow.png';
    case "Blood Overlord": return 'images/effects/blood.png';
    case "Lightning Strike": return 'images/effects/lightning.png';
    case "Sharingan": return 'images/effects/sharingan.png';
    case "Nine Tails": return 'images/effects/ninetails.png';
    case "Rocks": return 'images/effects/rocks.png';
    default: return '';
  }
}

/* ---------------- PLAYER STATS FROM WHEELS ---------------- */
function getPlayerStatsFromWheels(){
  return {
    race: currentCharacter.race?.name,
    hp: 100,
    maxHP: 100,
    strength: currentCharacter.wheels.strength || 5,
    durability: currentCharacter.wheels.durability || 10,
    regen: currentCharacter.wheels.regen || 2
  };
}

/* ---------------- BATTLE BACKGROUND ---------------- */
function setBattleBackground(playerRace, enemyRace, bgImage){
  let bg = bgImage ? `url(images/backgrounds/${bgImage})` : 'url(images/backgrounds/default_arena.png)';
  document.getElementById('battleContainer').style.backgroundImage = bg;
}

/* ---------------- SPIN EVENT WHEEL ---------------- */
function spinEventWheel(){
  const eventIndex = Math.floor(Math.random() * eventWheel.length);
  const selectedEvent = eventWheel[eventIndex];
  fightEvent(selectedEvent);
}

/* ---------------- FIGHT FUNCTION ---------------- */
function fightEvent(event){
  const player = getPlayerStatsFromWheels();
  const enemy = {
    race: event.enemyRace,
    hp: 100,
    maxHP: 100,
    strength: event.enemyStrength,
    durability: event.enemyDurability,
    regen: event.enemyRegen
  };
  setBattleBackground(player.race, enemy.race, event.background);

  let maxTurns = 30;
  let turn = 0;
  let fightLogText = `Event: ${event.name}\n\n`;

  while(player.hp > 0 && enemy.hp > 0 && turn < maxTurns){
    turn++;

    // Player attacks
    let rawDamage = player.strength - enemy.durability*0.1;
    let damage = Math.max(rawDamage,1);
    enemy.hp -= damage;
    enemy.hp += Math.min(enemy.regen, enemy.maxHP*0.1);
    enemy.hp = Math.min(enemy.hp, enemy.maxHP);

    // Enemy attacks
    rawDamage = enemy.strength - player.durability*0.1;
    damage = Math.max(rawDamage,1);
    player.hp -= damage;
    player.hp += Math.min(player.regen, player.maxHP*0.1);
    player.hp = Math.min(player.hp, player.maxHP);

    fightLogText += `Turn ${turn}: Player HP=${Math.round(player.hp)}, Enemy HP=${Math.round(enemy.hp)}\n`;
  }

  // Determine winner
  let winner;
  if(player.hp <= 0 && enemy.hp <= 0) winner = "Draw";
  else if(player.hp <= 0) winner = "Enemy Wins";
  else if(enemy.hp <= 0) winner = "Player Wins";
  else winner = player.hp > enemy.hp ? "Player Wins" : "Enemy Wins";

  fightLog.textContent = fightLogText + `\nResult: ${winner}`;

  // Particle effects
  showParticleEffect(getAttackEffect(player.power?.name), "playerParticle1");
  showParticleEffect(getAttackEffect("Fire"), "enemyParticle1"); // Placeholder enemy power
}
</script>
</body>
</html>
