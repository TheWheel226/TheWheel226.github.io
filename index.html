<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wheel RPG</title>

<style>
body{margin:0;font-family:system-ui;background:#0a0f1c;color:#e8eeff}
#bgLayer{position:fixed;inset:0;background-size:cover;background-position:center;opacity:.25;transition:.6s}
#bgVignette{position:fixed;inset:0;background:radial-gradient(ellipse at center,rgba(0,0,0,.2),rgba(0,0,0,.8))}
#game{display:flex;min-height:100vh;position:relative}
#left{width:260px;background:#111a33;padding:14px;border-right:2px solid #2a3b7a}
.stat{background:#18224a;padding:10px;border-radius:8px;margin:8px 0}
.k{font-size:12px;color:#9fb0ff}
.v{font-size:15px;font-weight:800}
#main{flex:1;padding:14px}
.panel{background:#111a33;border-radius:12px;padding:12px;margin-bottom:14px}
.btn{background:#4b7cff;color:white;border:none;padding:10px 14px;border-radius:10px;font-weight:800}
.btn:disabled{opacity:.4}
.btn.secondary{background:#222d66}
#pointer{width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-bottom:22px solid white;margin:-6px auto}
canvas{border-radius:50%;background:#0004;border:2px solid #4b7cff}
input{width:100%;padding:10px;border-radius:10px;border:none;background:#0006;color:white}
</style>
</head>

<body>
<div id="bgLayer"></div><div id="bgVignette"></div>

<div id="game">
<div id="left">
  <div class="stat"><div class="k">Name</div><div class="v" id="s_name">---</div></div>
  <div class="stat"><div class="k">Race</div><div class="v" id="s_race">---</div></div>
  <div class="stat"><div class="k">Power</div><div class="v" id="s_power">---</div></div>
  <div class="stat"><div class="k">Weapon</div><div class="v" id="s_weapon">---</div></div>
  <div class="stat"><div class="k">Strength</div><div class="v" id="s_str">---</div></div>
  <div class="stat"><div class="k">Durability</div><div class="v" id="s_dur">---</div></div>
  <div class="stat"><div class="k">Regen</div><div class="v" id="s_regen">---</div></div>
</div>

<div id="main">
  <div class="panel">
    <h2 id="wheelTitle">Spin for Race</h2>
    <div id="pointer"></div>
    <canvas id="wheelCanvas" width="300" height="300"></canvas>
    <button class="btn" id="spinBtn" onclick="startSpin()">SPIN</button>
    <div id="spinResult">---</div>
    <div id="spinMeta"></div>

    <div id="nameBox" style="display:none;margin-top:10px">
      <input id="nameInput" placeholder="Enter name">
      <button class="btn" onclick="confirmName()">Confirm Name</button>
    </div>

    <div style="margin-top:10px">
      <button class="btn secondary" onclick="toggleMute()" id="muteBtn">ðŸ”Š</button>
      <input type="range" min="0" max="100" value="60" oninput="setVolume(this.value)">
    </div>
  </div>
</div>
</div>

<script>
/* ================= SETTINGS ================= */
const DEV_MODE = true;

/* ================= DATA ================= */
const WHEELS={
 race:["Human","Golem","Vampire","God","Goblin"],
 power:["No power","Regeneration","Fire manipulation","Time manipulation","Toon force"],
 weapon:["No weapon","Sword","Hammer","Scythe"],
 strength:[10,20,30,40,50],
 durability:[10,20,30,40,50],
 regen:[0,2,4,6,8]
};

const BG={
 Vampire:"images/backgrounds/castle.svg",
 Golem:"images/backgrounds/cave.svg",
 Goblin:"images/backgrounds/forest.svg",
 God:"images/backgrounds/celestial.svg",
 Human:"images/backgrounds/city.svg",
 Default:"images/backgrounds/default_arena.svg"
};

/* ================= STATE ================= */
let state={step:0,spinning:false,locked:false,
 char:{name:"",race:null,power:null,weapon:null,strength:null,durability:null,regen:null}
};

/* ================= AUDIO (PROCEDURAL) ================= */
let audioCtx,masterGain,spinOsc,spinNoise;
let volume=0.6,muted=false;

function initAudio(){
 if(audioCtx) return;
 audioCtx=new (window.AudioContext||webkitAudioContext)();
 masterGain=audioCtx.createGain();
 masterGain.connect(audioCtx.destination);
 setMaster();
}
document.addEventListener("click",()=>{initAudio();audioCtx.resume()},{once:true});

function setMaster(){if(masterGain)masterGain.gain.value=muted?0:volume}
function setVolume(v){volume=v/100;setMaster()}
function toggleMute(){muted=!muted;setMaster();document.getElementById("muteBtn").textContent=muted?"ðŸ”‡":"ðŸ”Š"}

function playSpin(){
 initAudio();stopSpin();
 spinOsc=audioCtx.createOscillator();
 spinOsc.type="sawtooth";spinOsc.frequency.value=140;
 const g=audioCtx.createGain();g.gain.value=.06;
 spinOsc.connect(g);g.connect(masterGain);spinOsc.start();
}
function stopSpin(){if(spinOsc){spinOsc.stop();spinOsc=null}}
function setPitch(v){if(spinOsc)spinOsc.frequency.value=80+v*300}
function tick(){const o=audioCtx.createOscillator();const g=audioCtx.createGain();
 o.type="square";o.frequency.value=1200;g.gain.value=.15;
 o.connect(g);g.connect(masterGain);o.start();o.stop(audioCtx.currentTime+.03)}
function raritySound(p){if(p<5)beep(900,.3);else if(p<15)beep(600,.2);else beep(400,.1)}
function beep(f,d){const o=audioCtx.createOscillator();const g=audioCtx.createGain();
 o.frequency.value=f;g.gain.value=.2;o.connect(g);g.connect(masterGain);o.start();o.stop(audioCtx.currentTime+d)}

/* ================= WHEEL ================= */
const canvas=document.getElementById("wheelCanvas");
const ctx=canvas.getContext("2d");
let angle=0,vel=0,target=0,items=[];

function stepKey(){return["race","power","weapon","strength","durability","regen"][state.step]}
function draw(){
 ctx.clearRect(0,0,300,300);
 const n=items.length; if(!n)return;
 const slice=2*Math.PI/n;
 for(let i=0;i<n;i++){
  ctx.beginPath();ctx.moveTo(150,150);
  ctx.arc(150,150,140,angle+i*slice,angle+(i+1)*slice);
  ctx.fillStyle=i%2?"#4b7cff":"#36d399";ctx.fill();
 }
}
function startSpin(){
 if(state.locked||state.spinning)return;
 items=WHEELS[stepKey()].map(String);
 vel=.5;target=angle+Math.PI*2*(5+Math.random()*3);
 state.spinning=true;playSpin();animate();
}
function animate(){
 angle+=vel;vel*=.985;setPitch(vel);
 draw();tick();
 if(Math.abs(target-angle)<.02){
  state.spinning=false;stopSpin();
  const idx=Math.floor(((target%(2*Math.PI))/(2*Math.PI))*items.length);
  onResult(items[idx]);return;
 }
 requestAnimationFrame(animate);
}
function onResult(v){
 state.char[stepKey()]=isNaN(v)?v:Number(v);
 document.getElementById("spinResult").textContent=v;
 raritySound(20);
 if(stepKey()==="race"){
  document.getElementById("bgLayer").style.backgroundImage=`url('${BG[v]||BG.Default}')`;
 }
 state.step++;
 if(state.step>5){state.locked=true;document.getElementById("nameBox").style.display="block"}
 updateUI();
}

/* ================= UI ================= */
function updateUI(){
 const c=state.char;
 s_name.textContent=c.name||"---";
 s_race.textContent=c.race||"---";
 s_power.textContent=c.power||"---";
 s_weapon.textContent=c.weapon||"---";
 s_str.textContent=c.strength??"---";
 s_dur.textContent=c.durability??"---";
 s_regen.textContent=c.regen??"---";
 wheelTitle.textContent="Spin for "+(stepKey()||"Done");
}
function confirmName(){state.char.name=nameInput.value;updateUI();}

updateUI();
</script>
</body>
</html>
